# Suppression file for memory leaks
# found by AddressSanitizer (ASAN)
#
leak:_flush_send_queue_CT
leak:qd_dispatch_configure_connector
leak:parse_failover_property_list
leak:load_server_config
leak:qd_message_receive
leak:qd_policy_c_counts_alloc
leak:qd_policy_open_fetch_settings
leak:qdr_error_description

# DISPATCH-1844 - shutdown leak
#leak:sys_mutex

# expected, not a bug:
#
#leak:qdr_core_subscribe

# Ubuntu 16.04 (Xenial)
#
leak:_ctypes_alloc_format_string
leak:__strdup

# to be triaged; pretty much all tests
leak:^IoAdapter_init$

# to be triaged; system_tests_http
leak:^callback_healthz$
leak:^callback_metrics$

# to be triaged; system_tests_http1_adaptor
leak:^pn_condition$
leak:^pn_raw_connection$

####
#### Miscellaneous 3rd party libraries:
####

# these leaks happen even after simple Py_Initialize(); Py_Finalize();
#  https://bugs.python.org/issue1635741
leak:^_PyObject_Realloc
leak:^PyObject_Malloc$
leak:^PyThread_allocate_lock$

# the PyMalloc mechanism is incompatible with Valgrind, it must be disabled or reported "leaks" must be suppressed
#  https://pythonextensionpatterns.readthedocs.io/en/latest/debugging/debug_python.html#debug-version-of-python-memory-alloc-label
leak:^PyMem_Malloc$
leak:^PyMem_Calloc$
leak:^_PyObject_GC_Resize$
# Python uses these alloc functions if you define PYTHONDEVMODE=1
leak:^_PyMem_DebugRawAlloc$
leak:^_PyMem_DebugRawRealloc$

# Wholesale library suppressions, avoid doing this if at all possible
#  one reason we may not be able to avoid doing this is compatibility with multiple versions of libs on many operating systems
leak:/libpython2.*.so
#leak:/libpython3.*.so
#leak:/libwebsockets.so
#leak:libqpid-proton

# We might be able to remove these once all known dispatch leaks have been fixed
# Suppressions taken from Proton's lsan.supp
#  this appears in system_tests_open_properties:
leak:^pni_data_grow$
leak:^pn_buffer_ensure$
#  this appears in system_tests_http1_adaptor
leak:^pn_string_grow$
leak:^pn_object_new$
leak:^pn_list$
leak:^pni_record_create$
